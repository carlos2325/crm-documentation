<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“‹ CRM - Sistema de GestiÃ³n de Relaciones con Clientes</title>
    <meta name="description" content="DocumentaciÃ³n completa del sistema CRM desarrollado con Node.js, TypeScript, GraphQL y React">
    <meta name="keywords" content="CRM, GraphQL, Node.js, TypeScript, React, MongoDB, Firebase">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/images/favicon.ico">
    
    <!-- CSS -->
    <link rel="stylesheet" href="assets/css/style.css">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Prism.js para syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-chart-line"></i>
                    <h1>CRM Marketing Soluciones</h1>
                </div>
                <nav class="nav">
                    <ul>
                        <li><a href="#home" class="nav-link active">Inicio</a></li>
                        <li><a href="#indice-api" class="nav-link">ğŸ“š Ãndice</a></li>
                        <li><a href="#api" class="nav-link">API GraphQL</a></li>
                        <li><a href="#frontend" class="nav-link">Frontend</a></li>
                        <li><a href="#examples" class="nav-link">Ejemplos</a></li>
                        <li><a href="#deployment" class="nav-link">Deployment</a></li>
                    </ul>
                </nav>
                <div class="mobile-menu-toggle">
                    <i class="fas fa-bars"></i>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <!-- Hero Section -->
        <section id="home" class="hero">
            <div class="container">
                <div class="hero-content">
                    <h2>ğŸ“‹ Sistema CRM Completo</h2>
                    <p class="hero-subtitle">GestiÃ³n de Relaciones con Clientes</p>
                    <p class="hero-description">
                        Sistema CRM desarrollado con Node.js, TypeScript, GraphQL y React para gestionar 
                        leads, contactos, entidades y oportunidades de negocio de manera eficiente.
                    </p>
                    <div class="hero-buttons">
                        <a href="#api" class="btn btn-primary">
                            <i class="fas fa-code"></i>
                            Ver API GraphQL
                        </a>
                        <a href="#frontend" class="btn btn-secondary">
                            <i class="fas fa-laptop-code"></i>
                            ConfiguraciÃ³n Frontend
                        </a>
                    </div>
                </div>
                <div class="hero-image">
                    <i class="fas fa-users-cog"></i>
                </div>
            </div>
        </section>

        <!-- Architecture Section -->
        <section class="architecture">
            <div class="container">
                <h3>ğŸ—ï¸ Arquitectura del Sistema</h3>
                <div class="tech-grid">
                    <div class="tech-card">
                        <i class="fab fa-node-js"></i>
                        <h4>Backend</h4>
                        <p>Node.js + TypeScript + GraphQL</p>
                    </div>
                    <div class="tech-card">
                        <i class="fas fa-database"></i>
                        <h4>Base de Datos</h4>
                        <p>MongoDB Atlas</p>
                    </div>
                    <div class="tech-card">
                        <i class="fas fa-fire"></i>
                        <h4>AutenticaciÃ³n</h4>
                        <p>Firebase JWT</p>
                    </div>
                    <div class="tech-card">
                        <i class="fab fa-react"></i>
                        <h4>Frontend</h4>
                        <p>React + TypeScript + Apollo Client</p>
                    </div>
                    <div class="tech-card">
                        <i class="fab fa-docker"></i>
                        <h4>Deployment</h4>
                        <p>Docker + Nginx</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Ãndice Completo de la API -->
        <section id="indice-api" class="section">
            <div class="container">
                <div class="section-header">
                    <h3><i class="fas fa-list"></i> ğŸ“š Ãndice Completo de la API GraphQL</h3>
                    <p>NavegaciÃ³n rÃ¡pida a todas las funcionalidades del CRM</p>
                </div>
                
                <div class="content-card">
                    <div class="index-grid">
                        <div class="index-category">
                            <h4><i class="fas fa-database"></i> ğŸ—ï¸ Esquema y Tipos de Datos</h4>
                            <ul>
                                <li><a href="#tipos-crm">ğŸ“Š Tipos Principales del CRM</a>
                                    <ul>
                                        <li>CRM_Lead (26 campos)</li>
                                        <li>CRM_Contact (32 campos)</li>
                                        <li>CRM_Entity (26 campos)</li>
                                    </ul>
                                </li>
                                <li><a href="#enums">ğŸ”§ Enums y Tipos Especializados</a>
                                    <ul>
                                        <li>LeadStatus, LeadSource, Priority</li>
                                        <li>EventType, CampaignType</li>
                                        <li>EntityType, CompanySize</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>

                        <div class="index-category">
                            <h4><i class="fas fa-code"></i> ğŸ” Queries y Mutations</h4>
                            <ul>
                                <li><a href="#queries">ğŸ“¥ Queries Principales</a>
                                    <ul>
                                        <li>getCRMLeads - Obtener leads con filtros</li>
                                        <li>getCRMContacts - Obtener contactos</li>
                                        <li>getCRMEntities - Obtener entidades</li>
                                        <li>getLeadAnalytics - Dashboard de leads</li>
                                    </ul>
                                </li>
                                <li><a href="#mutations">ğŸ“¤ Mutations Principales</a>
                                    <ul>
                                        <li>createCRMLead - Crear lead</li>
                                        <li>updateCRMLead - Actualizar lead</li>
                                        <li>deleteCRMLead - Eliminar lead</li>
                                        <li>convertLead - Convertir lead</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>

                        <div class="index-category">
                            <h4><i class="fas fa-bolt"></i> ğŸ“¡ Subscriptions y Webhooks</h4>
                            <ul>
                                <li><a href="#subscriptions">âš¡ Subscriptions en Tiempo Real</a>
                                    <ul>
                                        <li>leadChanges - Cambios en leads</li>
                                        <li>activityUpdates - Actualizaciones de actividad</li>
                                        <li>notifications - Notificaciones del sistema</li>
                                    </ul>
                                </li>
                                <li><a href="#webhooks">ğŸ”— Webhooks y Integraciones</a>
                                    <ul>
                                        <li>createWebhook - Configurar webhook</li>
                                        <li>getWebhookLogs - Logs de webhooks</li>
                                        <li>testWebhook - Probar webhook</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>

                        <div class="index-category">
                            <h4><i class="fas fa-calendar-alt"></i> ğŸ‰ MÃ³dulo de Eventos (EVT)</h4>
                            <ul>
                                <li><a href="#eventos">ğŸ“… GestiÃ³n de Eventos</a>
                                    <ul>
                                        <li>EVT_Event - Tipo principal de evento (estructura real)</li>
                                        <li>EVT_Invitado - GestiÃ³n de invitados y asistentes</li>
                                        <li>EVT_Presupuesto - Presupuesto y categorÃ­as de gastos</li>
                                        <li>EVT_Itinerario - Tareas y programaciÃ³n del evento</li>
                                    </ul>
                                </li>
                                <li><a href="#event-queries">ğŸ” Queries de Eventos</a>
                                    <ul>
                                        <li>getEvent - Obtener evento por ID</li>
                                        <li>getEventsByBrand - Eventos por marca</li>
                                        <li>getAllUserRelatedEvents - Eventos del usuario</li>
                                        <li>getEventDataForAI - Datos optimizados para IA</li>
                                    </ul>
                                </li>
                                <li><a href="#event-mutations">ğŸ“¤ Mutations de Eventos</a>
                                    <ul>
                                        <li>createEvent - Crear nuevo evento</li>
                                        <li>updateEventBasicInfo - Actualizar informaciÃ³n bÃ¡sica</li>
                                        <li>addGuest - Agregar invitado</li>
                                        <li>addBudgetCategory - Agregar categorÃ­a de presupuesto</li>
                                    </ul>
                                </li>
                                <li><a href="#event-permissions">ğŸ” Sistema de Permisos</a>
                                    <ul>
                                        <li>Roles: CREADOR, COMPARTIDO, INVITADO</li>
                                        <li>Permisos granulares por funcionalidad</li>
                                        <li>Sistema de compartir eventos</li>
                                        <li>Control de acceso granular</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>

                        <div class="index-category">
                            <h4><i class="fas fa-rocket"></i> ğŸš€ MÃ³dulo de CampaÃ±as (BUSN)</h4>
                            <ul>
                                <li><a href="#campanas">ğŸ“¢ GestiÃ³n de CampaÃ±as</a>
                                    <ul>
                                        <li>CRM_Campaign - Tipo principal de campaÃ±a</li>
                                        <li>CampaignObjective - Objetivos y KPIs</li>
                                        <li>TargetAudience - Audiencia y segmentaciÃ³n</li>
                                        <li>CampaignBudget - Presupuesto y ROI</li>
                                    </ul>
                                </li>
                                <li><a href="#campaign-queries">ğŸ” Queries de CampaÃ±as</a>
                                    <ul>
                                        <li>getCampaigns - Obtener campaÃ±as</li>
                                        <li>getCampaignAnalytics - Analytics de campaÃ±as</li>
                                        <li>getCampaignPerformance - Rendimiento</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>

                        <div class="index-category">
                            <h4><i class="fas fa-chart-line"></i> ğŸ“Š MÃ©tricas y Analytics</h4>
                            <ul>
                                <li><a href="#metricas">ğŸ“ˆ Dashboard y Reportes</a>
                                    <ul>
                                        <li>Lead Analytics - ConversiÃ³n y rendimiento</li>
                                        <li>Campaign Analytics - ROI y engagement</li>
                                        <li>Event Analytics - Asistencia y satisfacciÃ³n</li>
                                        <li>User Performance - Productividad del equipo</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>

                        <div class="index-category">
                            <h4><i class="fas fa-shield-alt"></i> ğŸ” Seguridad y Permisos</h4>
                            <ul>
                                <li><a href="#autenticacion">ğŸ”‘ AutenticaciÃ³n JWT</a>
                                    <ul>
                                        <li>Headers requeridos</li>
                                        <li>Token management</li>
                                        <li>Refresh tokens</li>
                                    </ul>
                                </li>
                                <li><a href="#permisos">ğŸ‘¥ Control de Acceso RBAC</a>
                                    <ul>
                                        <li>Admin - Acceso completo</li>
                                        <li>Manager - Acceso de equipo</li>
                                        <li>Sales - Acceso limitado</li>
                                        <li>Viewer - Solo lectura</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>

                        <div class="index-category">
                            <h4><i class="fas fa-tools"></i> ğŸ§ª Testing y Desarrollo</h4>
                            <ul>
                                <li><a href="#testing">ğŸ”¬ Entorno de Testing</a>
                                    <ul>
                                        <li>Endpoint de test</li>
                                        <li>Base de datos separada</li>
                                        <li>Herramientas recomendadas</li>
                                    </ul>
                                </li>
                                <li><a href="#development">ğŸ’» GuÃ­a de Desarrollo</a>
                                    <ul>
                                        <li>ConfiguraciÃ³n inicial</li>
                                        <li>Ejemplos de implementaciÃ³n</li>
                                        <li>Mejores prÃ¡cticas</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- API GraphQL Section -->
        <section id="api" class="section">
            <div class="container">
                <div class="section-header">
                    <h3><i class="fas fa-code"></i> API GraphQL</h3>
                    <p>DocumentaciÃ³n completa de endpoints y operaciones</p>
                </div>
                
                <div class="content-card">
                    <h4>ğŸŒ Endpoints Disponibles</h4>
                    <div class="endpoint-grid">
                        <div class="endpoint-card production">
                            <h5><i class="fas fa-server"></i> ProducciÃ³n</h5>
                            <code>https://api2.eventosorganizador.com/graphql</code>
                            <span class="status-badge">ğŸŸ¢ Activo</span>
                        </div>
                        <div class="endpoint-card test">
                            <h5><i class="fas fa-flask"></i> Test</h5>
                            <code>https://testapi2.eventosorganizador.com/graphql</code>
                            <span class="status-badge">ğŸŸ¡ Test</span>
                        </div>
                    </div>

                    <h4>ğŸ” AutenticaciÃ³n</h4>
                    <div class="auth-example">
                        <p><strong>Headers Requeridos:</strong></p>
                        <pre><code class="language-http">Authorization: Bearer &lt;JWT_TOKEN&gt;
X-User-ID: &lt;USER_UID&gt;
X-Development: &lt;DEVELOPMENT_ID&gt;</code></pre>
                    </div>

                    <h4>ğŸ“Š Operaciones Disponibles</h4>
                    <div class="operations-grid">
                        <div class="operation-card">
                            <h5><i class="fas fa-user-plus"></i> Leads (Prospectos)</h5>
                            <ul>
                                <li>Crear lead</li>
                                <li>Obtener leads</li>
                                <li>Actualizar lead</li>
                                <li>Eliminar lead</li>
                            </ul>
                        </div>
                        <div class="operation-card">
                            <h5><i class="fas fa-address-book"></i> Contactos</h5>
                            <ul>
                                <li>Crear contacto</li>
                                <li>Obtener contactos</li>
                                <li>Actualizar contacto</li>
                                <li>Eliminar contacto</li>
                            </ul>
                        </div>
                        <div class="operation-card">
                            <h5><i class="fas fa-building"></i> Entidades</h5>
                            <ul>
                                <li>Crear entidad</li>
                                <li>Obtener entidades</li>
                                <li>Actualizar entidad</li>
                                <li>Eliminar entidad</li>
                            </ul>
                        </div>
                    </div>

                    <h4>ğŸ§ª Testing de la API</h4>
                    <div class="testing-example">
                        <p><strong>Ejemplo con cURL:</strong></p>
                        <pre><code class="language-bash"># Obtener leads
curl -X POST \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "X-User-ID: YOUR_USER_UID" \
  -H "X-Development: YOUR_DEVELOPMENT_ID" \
  -d '{
    "query": "query { getCRMLeads { leads { id name email company status } } }"
  }' \
  https://api2.eventosorganizador.com/graphql</code></pre>
                    </div>

                    <h4>ğŸ—ï¸ Esquema y Tipos de Datos</h4>
                    <div class="schema-section">
                        <h5>Tipos Principales del CRM</h5>
                        
                        <div class="type-card">
                            <h6><i class="fas fa-user-plus"></i> CRM_Lead (26 campos)</h6>
                            <pre><code class="language-graphql">type CRM_Lead {
  _id: ID!
  name: String!
  email: String!
  company: String
  phone: String
  status: LeadStatus!
  source: LeadSource!
  value: Float
  probability: Float
  assignedTo: String
  tags: [String]
  description: String
  nextFollowUp: DateTime
  lastContact: DateTime
  createdAt: DateTime!
  updatedAt: DateTime!
  convertedTo: String
  convertedAt: DateTime
  score: Int
  priority: Priority!
  expectedCloseDate: DateTime
  actualCloseDate: DateTime
  lostReason: String
  wonReason: String
  notes: [CRM_Note]
  reminders: [CRM_Reminder]
  activities: [Activity]
  customFields: JSON
}</code></pre>
                        </div>

                        <div class="type-card">
                            <h6><i class="fas fa-address-book"></i> CRM_Contact (32 campos)</h6>
                            <pre><code class="language-graphql">type CRM_Contact {
  _id: ID!
  firstName: String!
  lastName: String!
  email: String!
  phone: String
  mobile: String
  company: String
  jobTitle: String
  department: String
  address: Address
  socialMedia: SocialMedia
  birthday: DateTime
  anniversary: DateTime
  preferences: ContactPreferences
  tags: [String]
  status: ContactStatus!
  source: ContactSource!
  assignedTo: String
  createdAt: DateTime!
  updatedAt: DateTime!
  lastContact: DateTime
  nextFollowUp: DateTime
  notes: [CRM_Note]
  reminders: [CRM_Reminder]
  activities: [Activity]
  customFields: JSON
  relationships: [Relationship]
  campaigns: [CRM_Campaign]
  events: [EVT_Event]
}</code></pre>
                        </div>

                        <div class="type-card">
                            <h6><i class="fas fa-building"></i> CRM_Entity (26 campos)</h6>
                            <pre><code class="language-graphql">type CRM_Entity {
  _id: ID!
  name: String!
  type: EntityType!
  industry: String
  size: CompanySize
  website: String
  phone: String
  email: String
  address: Address
  description: String
  founded: Int
  revenue: Float
  employees: Int
  status: EntityStatus!
  assignedTo: String
  tags: [String]
  createdAt: DateTime!
  updatedAt: DateTime!
  lastContact: DateTime
  nextFollowUp: DateTime
  contacts: [CRM_Contact]
  leads: [CRM_Lead]
  opportunities: [Opportunity]
  activities: [Activity]
  customFields: JSON
}</code></pre>
                        </div>
                    </div>

                    <h4>ğŸ“¡ Subscriptions y Webhooks</h4>
                    <div class="subscriptions-section">
                        <h5>Subscriptions en Tiempo Real</h5>
                        <pre><code class="language-graphql">subscription LeadChanges($filters: LeadFilterInput) {
  leadChanges(filters: $filters) {
    operation: ChangeOperation!
    lead: CRM_Lead!
    previousValues: CRM_Lead
    timestamp: DateTime!
    userId: String
    userName: String
    changes: [FieldChange!]!
  }
}</code></pre>
                        
                        <h5>Webhooks y Integraciones</h5>
                        <pre><code class="language-graphql">mutation CreateWebhook($input: WebhookInput!) {
  createWebhook(input: $input) {
    _id: ID!
    name: String!
    url: String!
    events: [WebhookEvent!]!
    secret: String!
    active: Boolean!
    retryCount: Int!
    timeout: Int!
    headers: [WebhookHeader!]
    filters: WebhookFilters
    createdAt: DateTime!
    updatedAt: DateTime!
  }
}</code></pre>
                    </div>

                    <h4>ğŸ‰ MÃ³dulo de Eventos (EVT) - Estructura Real</h4>
                    <div class="events-section">
                        <h5>GestiÃ³n de Eventos (ImplementaciÃ³n Actual)</h5>
                        <pre><code class="language-graphql">type EVT_Event {
  _id: ID!
  development: String
  estatus: String
  fecha_creacion: String
  fecha_actualizacion: String
  
  # Datos bÃ¡sicos
  tipo: String
  color: [String]
  nombre: String
  fecha: String
  poblacion: String
  pais: String
  
  # GestiÃ³n de usuarios
  usuario_id: String
  usuario_nombre: String
  compartido_array: [String]
  detalles_compartidos_array: [JSON]
  
  # Datos complejos
  invitados_array: [EVT_Invitado]
  presupuesto_objeto: EVT_Presupuesto
  itinerarios_array: [EVT_Itinerario]
  
  # Otros campos
  planSpace: [JSON]
  planSpaceSelect: String
  mesas_array: [JSON]
  menus_array: [JSON]
  grupos_array: [String]
  
  # InformaciÃ³n de rol y permisos del usuario
  user_role: String
  user_permissions: [String]
  invitados_count: Int
  compartido_count: Int
}

type EVT_Invitado {
  _id: ID
  nombre: String
  correo: String
  telefono: String
  asistencia: String
  alergenos: [String]
  grupo_relacion: String
  nombre_mesa: String
  puesto: String
  usuario_id: String
}

type EVT_Presupuesto {
  coste_proporcion: Float
  coste_estimado: Float
  coste_final: Float
  pagado: Float
  categorias_array: [EVT_CategoriaPresupuesto]
  currency: String
  totalStimatedGuests: EVT_TotalStimatedGuests
}

type EVT_Itinerario {
  _id: ID
  title: String
  tipo: String
  estatus: Boolean
  tasks: [EVT_Task]
}</code></pre>
                        
                        <h5>ğŸ” Queries Disponibles</h5>
                        <pre><code class="language-graphql"># Obtener evento por ID
getEvent(eventId: ID!): EVT_Event

# Obtener eventos por marca
getEventsByBrand(brandId: String!): [EVT_Event]

# Obtener todos los eventos relacionados con un usuario
getAllUserRelatedEvents(userId: String!): [EVT_Event]
getAllUserRelatedEventsByPhone(phoneNumber: String!): [EVT_Event]
getAllUserRelatedEventsByEmail(email: String!): [EVT_Event]

# Datos optimizados para IA
getEventDataForAI(eventId: ID!): EVT_EventAI

# Resumen completo del usuario
getUserCompleteEventSummary(userIdentifier: String!): EVT_UserEventSummary</code></pre>
                        
                        <h5>ğŸ“¤ Mutations Disponibles</h5>
                        <pre><code class="language-graphql"># Crear y actualizar eventos
createEvent(input: EVT_EventInput!): EVT_Event
updateEventBasicInfo(eventId: ID!, input: EVT_EventInput!): EVT_Event

# GestiÃ³n de permisos
shareEvent(eventId: ID!, userId: ID!, permissions: JSON!): Boolean

# GestiÃ³n de invitados
addGuest(eventId: ID!, nombre: String!, correo: String, telefono: String): EVT_Invitado
updateGuestAttendance(eventId: ID!, guestId: ID!, asistencia: String!): EVT_Invitado

# GestiÃ³n de presupuesto
addBudgetCategory(eventId: ID!, nombre: String!, coste_estimado: Float!): EVT_CategoriaPresupuesto
addExpense(eventId: ID!, categoryId: ID!, nombre: String!, coste_estimado: Float!): EVT_Gasto</code></pre>

                        <h5>ğŸ¤– Tipos Especializados para IA y ResÃºmenes</h5>
                        <pre><code class="language-graphql"># Tipo optimizado para IA
type EVT_EventAI {
  eventId: ID!
  basicInfo: EVT_Event
  tasks: [EVT_Task]
  guests: [EVT_GuestBasic]
  budget: EVT_Presupuesto
}

type EVT_GuestBasic {
  nombre: String
  asistencia: String
}

# Tipo completo para resumen de usuario optimizado para MCP/IA
type EVT_UserEventSummary {
  userInfo: EVT_UserInfo
  eventsSummary: EVT_EventsSummary
  permissionsSummary: EVT_PermissionsSummary
  recommendations: [String]
}

type EVT_UserInfo {
  identifier: String!
  firebaseUID: String
  email: String
  phone: String
  userType: String # "FIREBASE_USER", "EMAIL_ONLY", "PHONE_ONLY"
}

type EVT_EventsSummary {
  totalEvents: Int!
  eventsByRole: EVT_EventsByRole
  eventsByType: [EVT_EventTypeCount]
  recentEvents: [EVT_EventBasic]
  upcomingEvents: [EVT_EventBasic]
}

type EVT_EventsByRole {
  creator: Int!
  shared: Int!
  invited: Int!
}

type EVT_EventTypeCount {
  type: String!
  count: Int!
}

type EVT_EventBasic {
  _id: ID!
  nombre: String!
  tipo: String!
  fecha: String!
  estatus: String!
  user_role: String!
  user_permissions: [String]!
  canViewBudget: Boolean!
  canViewItineraries: Boolean!
  canViewGuests: Boolean!
  canEditEvent: Boolean!
}

type EVT_PermissionsSummary {
  hasBudgetAccess: Boolean!
  hasItineraryAccess: Boolean!
  hasGuestAccess: Boolean!
  hasEditAccess: Boolean!
  totalPermissions: Int!
  permissionDetails: [EVT_PermissionDetail]
}

type EVT_PermissionDetail {
  eventId: ID!
  eventName: String!
  role: String!
  permissions: [String]!
  specificPermissions: EVT_SpecificPermissions
}

type EVT_SpecificPermissions {
  canViewBudget: Boolean!
  canViewConversations: Boolean!
  canViewChat: Boolean!
  canViewDocuments: Boolean!
  canEditEvent: Boolean!
  canInviteGuests: Boolean!
}</code></pre>

                        <h5>ğŸ“ Input Types y Validaciones</h5>
                        <pre><code class="language-graphql"># Input para crear/actualizar eventos
input EVT_EventInput {
  nombre: String!
  tipo: String!
  fecha: String!
  poblacion: String
  pais: String
  usuario_id: String!
  usuario_nombre: String!
  color: [String]
}

# Enums y Validaciones Implementadas
enum EventType {
  BODA
  COMUNION
  BAUTIZO
  CUMPLEANOS
  CORPORATIVO
  CONFERENCIA
  EXPOSICION
  FIESTA
  REUNION
  OTRO
}

enum EventStatus {
  PLANIFICACION
  CONFIRMADO
  EN_CURSO
  COMPLETADO
  CANCELADO
  POSTPUESTO
}

enum GuestAttendance {
  PENDIENTE
  CONFIRMADO
  RECHAZADO
  TAL_VEZ
}

enum UserRole {
  CREADOR
  COMPARTIDO
  INVITADO
  ADMIN
  VIEWER
}

enum PermissionType {
  VIEW_EVENT
  EDIT_EVENT
  DELETE_EVENT
  VIEW_BUDGET
  EDIT_BUDGET
  VIEW_GUESTS
  EDIT_GUESTS
  VIEW_ITINERARY
  EDIT_ITINERARY
  SHARE_EVENT
}</code></pre>

                        <h5>ğŸ’¡ Ejemplos de Uso Real</h5>
                        <pre><code class="language-graphql"># Ejemplo 1: Obtener evento por ID
query GetEventById {
  getEvent(eventId: "64f8a1b2c3d4e5f6a7b8c9d0") {
    _id
    nombre
    tipo
    fecha
    poblacion
    pais
    usuario_nombre
    invitados_count
    user_role
    user_permissions
  }
}

# Ejemplo 2: Obtener eventos del usuario por telÃ©fono
query GetUserEventsByPhone {
  getAllUserRelatedEventsByPhone(phoneNumber: "+34612345678") {
    _id
    nombre
    tipo
    fecha
    estatus
    user_role
    user_permissions
    invitados_count
  }
}

# Ejemplo 3: Obtener datos optimizados para IA
query GetEventDataForAI {
  getEventDataForAI(eventId: "64f8a1b2c3d4e5f6a7b8c9d0") {
    eventId
    basicInfo {
      nombre
      tipo
      fecha
      poblacion
    }
    guests {
      nombre
      asistencia
    }
    budget {
      coste_estimado
      coste_final
    }
  }
}

# Ejemplo 4: Resumen completo del usuario
query GetUserEventSummary {
  getUserCompleteEventSummary(userIdentifier: "user@example.com") {
    userInfo {
      identifier
      email
      userType
    }
    eventsSummary {
      totalEvents
      eventsByRole {
        creator
        shared
        invited
      }
    }
    permissionsSummary {
      hasBudgetAccess
      hasEditAccess
      totalPermissions
    }
    recommendations
  }
}</code></pre>

                        <h5>ğŸ” Sistema de Permisos y ComparticiÃ³n</h5>
                        <pre><code class="language-graphql"># Sistema de Roles Implementado
enum UserRole {
  CREADOR      # Propietario del evento - Acceso completo
  COMPARTIDO   # Usuario con acceso compartido - Acceso bÃ¡sico
  INVITADO     # Usuario invitado - Acceso limitado
  SIN_ACCESO   # Sin permisos - No puede ver el evento
}

# Permisos Granulares por Rol
type UserPermissions {
  # Permisos de VisualizaciÃ³n
  canViewBudget: Boolean!        # Ver presupuesto
  canViewAllGuests: Boolean!     # Ver lista completa de invitados
  canViewItineraries: Boolean!   # Ver itinerarios y tareas
  canViewShared: Boolean!        # Ver informaciÃ³n compartida
  
  # Permisos de EdiciÃ³n
  canEditEvent: Boolean!         # Editar informaciÃ³n del evento
  canInviteGuests: Boolean!      # Invitar nuevos invitados
  canDeleteEvent: Boolean!       # Eliminar el evento
  canShareEvent: Boolean!        # Compartir con otros usuarios
  
  # Permisos EspecÃ­ficos
  canViewConversations: Boolean! # Ver conversaciones/chat
  canViewChat: Boolean!          # Acceso al chat del evento
  canViewDocuments: Boolean!     # Ver documentos adjuntos
}

# Matriz de Permisos por Rol
type PermissionsMatrix {
  CREADOR: UserPermissions!      # Acceso completo
  COMPARTIDO: UserPermissions!   # Acceso bÃ¡sico con restricciones
  INVITADO: UserPermissions!     # Solo informaciÃ³n bÃ¡sica
}</code></pre>

                        <h5>ğŸ—ï¸ Arquitectura del Sistema de Permisos</h5>
                        <pre><code class="language-graphql"># Servicios de Permisos Implementados
type PermissionServices {
  EventPermissionService: String!           # Servicio principal de permisos
  EnhancedEventPermissionService: String!   # Servicio mejorado con filtrado
  EventPermissionModel: String!            # Modelo de base de datos
}

# JerarquÃ­a de Prioridades para Determinar Rol
enum RolePriority {
  CREADOR      # PRIORIDAD MÃXIMA - Propietario del evento
  COMPARTIDO   # PRIORIDAD MEDIA - Usuario compartido
  INVITADO     # PRIORIDAD BAJA - Usuario invitado
  SIN_ACCESO   # SIN ACCESO - No tiene permisos
}

# LÃ³gica de DeterminaciÃ³n de Rol
type RoleDetermination {
  # VerificaciÃ³n por ID de Usuario (MÃ¡xima prioridad)
  checkByUserId: Boolean!
  
  # VerificaciÃ³n por Email (Prioridad media)
  checkByEmail: Boolean!
  
  # VerificaciÃ³n por TelÃ©fono (Prioridad baja)
  checkByPhone: Boolean!
  
  # VerificaciÃ³n por InvitaciÃ³n (Prioridad mÃ­nima)
  checkByInvitation: Boolean!
}</code></pre>

                        <h5>ğŸ¤ Sistema de Compartir Implementado</h5>
                        <pre><code class="language-graphql"># Compartir Evento con Usuario
mutation ShareEvent($eventId: ID!, $userId: ID!, $permissions: JSON!) {
  shareEvent(eventId: $eventId, userId: $userId, permissions: $permissions)
}

# Estructura de Permisos para Compartir
input SharePermissionsInput {
  # Permisos de VisualizaciÃ³n
  canViewBudget: Boolean!
  canViewGuests: Boolean!
  canViewItineraries: Boolean!
  canViewDocuments: Boolean!
  
  # Permisos de EdiciÃ³n
  canEditEvent: Boolean!
  canInviteGuests: Boolean!
  canManageBudget: Boolean!
  canManageTasks: Boolean!
  
  # Permisos de AdministraciÃ³n
  canShareEvent: Boolean!
  canDeleteEvent: Boolean!
}

# Campos de ComparticiÃ³n en EVT_Event
type EventSharing {
  compartido_array: [String!]!              # IDs de usuarios compartidos
  detalles_compartidos_array: [ShareDetail!]! # Detalles de permisos por usuario
}

type ShareDetail {
  user_id: String!                          # ID del usuario compartido
  permissions: JSON!                         # Permisos especÃ­ficos
  shared_at: DateTime!                       # Fecha de comparticiÃ³n
  shared_by: String!                         # Usuario que compartiÃ³
  role: String!                              # Rol asignado
}</code></pre>

                        <h5>ğŸ’¡ Ejemplos de Uso del Sistema de Permisos</h5>
                        <pre><code class="language-graphql"># Ejemplo 1: Compartir evento con permisos especÃ­ficos
mutation ShareEventWithPermissions {
  shareEvent(
    eventId: "64f8a1b2c3d4e5f6a7b8c9d0"
    userId: "user123"
    permissions: {
      canViewBudget: true
      canViewGuests: true
      canViewItineraries: true
      canEditEvent: true
      canInviteGuests: true
      canShareEvent: false
      canDeleteEvent: false
    }
  )
}

# Ejemplo 2: Verificar permisos del usuario en evento
query CheckUserPermissions {
  getEvent(eventId: "64f8a1b2c3d4e5f6a7b8c9d0") {
    _id
    nombre
    user_role           # Rol del usuario actual
    user_permissions    # Permisos especÃ­ficos
    compartido_array    # Usuarios con acceso compartido
    detalles_compartidos_array {
      user_id
      permissions
      shared_at
      shared_by
      role
    }
  }
}

# Ejemplo 3: Obtener eventos segÃºn rol del usuario
query GetEventsByUserRole {
  getAllUserRelatedEvents(userId: "user123") {
    _id
    nombre
    tipo
    fecha
    user_role           # CREADOR, COMPARTIDO, INVITADO
    user_permissions    # Permisos especÃ­ficos
    # Campos filtrados segÃºn permisos
    invitados_array @include(if: $canViewGuests)
    presupuesto_objeto @include(if: $canViewBudget)
    itinerarios_array @include(if: $canViewItineraries)
  }
}</code></pre>

                        <h5>ğŸ¢ Sistema de Permisos para Otros MÃ³dulos CRM</h5>
                        <pre><code class="language-graphql"># Compartir Lead con Usuario
mutation ShareCRMLead($leadId: ID!, $sharing: LeadSharingInput!) {
  shareCRMLead(leadId: $leadId, sharing: $sharing) {
    success
    lead {
      _id
      name
      ownership {
        shared_with_users
        shared_with_groups
      }
    }
    errors
  }
}

# Compartir Contacto
mutation ShareCRMContact($contactId: ID!, $sharing: ContactSharingInput!) {
  shareCRMContact(contactId: $contactId, sharing: $sharing) {
    success
    contact {
      _id
      firstName
      lastName
      ownership {
        shared_with_users
        shared_with_groups
      }
    }
    errors
  }
}

# Compartir Entidad
mutation ShareCRMEntity($entityId: ID!, $sharing: EntitySharingInput!) {
  shareCRMEntity(entityId: $entityId, sharing: $sharing) {
    success
    entity {
      _id
      name
      ownership {
        shared_with_users
        shared_with_groups
      }
    }
    errors
  }
}

# Estructura de ComparticiÃ³n para CRM
input LeadSharingInput {
  userIds: [String!]!    # IDs de usuarios para compartir
  groupIds: [String!]!   # IDs de grupos para compartir
  permissions: [String!]! # Permisos especÃ­ficos
}

input ContactSharingInput {
  userIds: [String!]!
  groupIds: [String!]!
  permissions: [String!]!
}

input EntitySharingInput {
  userIds: [String!]!
  groupIds: [String!]!
  permissions: [String!]!
}</code></pre>

                        <h6>ğŸ‘¥ Sistema de Grupos y Permisos</h6>
                        <pre><code class="language-graphql"># Modelo de Grupo con permisos implementado
type CRM_Group {
  _id: ID!
  name: String!                    # Nombre del grupo
  description: String!             # DescripciÃ³n del grupo
  business: ID!                    # Negocio asociado (ObjectId)
  members: [String!]!              # Array de Firebase UIDs
  
  # Permisos del grupo
  permissions: CRM_GroupPermissions! {
    canView: Boolean!              # Ver recursos
    canEdit: Boolean!              # Editar recursos
    canDelete: Boolean!            # Eliminar recursos
    canShare: Boolean!             # Compartir recursos
    canManageMembers: Boolean!     # Gestionar miembros
  }
  
  # ConfiguraciÃ³n del grupo
  isActive: Boolean!               # Si el grupo estÃ¡ activo
  createdBy: String!               # Firebase UID del creador
  createdAt: DateTime!             # Fecha de creaciÃ³n
  updatedAt: DateTime!             # Fecha de actualizaciÃ³n
  
  # Filtros asociados al grupo
  filters: [ID!]                   # Array de ObjectIds de filtros
}

# Permisos del grupo
type CRM_GroupPermissions {
  canView: Boolean!                # Ver recursos
  canEdit: Boolean!                # Editar recursos
  canDelete: Boolean!              # Eliminar recursos
  canShare: Boolean!               # Compartir recursos
  canManageMembers: Boolean!       # Gestionar miembros del grupo
}</code></pre>

                        <h6>ğŸ“Š Diagramas Visuales del Sistema</h6>
                        
                        <h7>ğŸ—ï¸ Arquitectura Multi-Tenant</h7>
                        <pre><code class="language-text">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SISTEMA CRM MULTI-TENANT                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   DEVELOPER 1   â”‚    â”‚   DEVELOPER 2   â”‚    â”‚   DEVELOPER â”‚ â”‚
â”‚  â”‚  "bodasdehoy"   â”‚    â”‚"eventosorganiz"â”‚    â”‚      3      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                       â”‚                    â”‚        â”‚
â”‚           â”‚                       â”‚                    â”‚        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   WHITELABEL    â”‚    â”‚   WHITELABEL    â”‚    â”‚   WHITELABELâ”‚ â”‚
â”‚  â”‚   CONFIG        â”‚    â”‚   CONFIG        â”‚    â”‚   CONFIG    â”‚ â”‚
â”‚  â”‚                 â”‚    â”‚                 â”‚    â”‚             â”‚ â”‚
â”‚  â”‚ â€¢ Features      â”‚    â”‚ â€¢ Features      â”‚    â”‚ â€¢ Features  â”‚ â”‚
â”‚  â”‚ â€¢ Limits        â”‚    â”‚ â€¢ Limits        â”‚    â”‚ â€¢ Limits    â”‚ â”‚
â”‚  â”‚ â€¢ Settings      â”‚    â”‚ â€¢ Settings      â”‚    â”‚ â€¢ Settings  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                       â”‚                    â”‚        â”‚
â”‚           â”‚                       â”‚                    â”‚        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   BASE DE       â”‚    â”‚   BASE DE       â”‚    â”‚   BASE DE   â”‚ â”‚
â”‚  â”‚   DATOS         â”‚    â”‚   DATOS         â”‚    â”‚   DATOS     â”‚ â”‚
â”‚  â”‚                 â”‚    â”‚                 â”‚    â”‚             â”‚ â”‚
â”‚  â”‚ â€¢ crm_leads     â”‚    â”‚ â€¢ crm_leads     â”‚    â”‚ â€¢ crm_leads â”‚ â”‚
â”‚  â”‚ â€¢ crm_contacts  â”‚    â”‚ â€¢ crm_contacts  â”‚    â”‚ â€¢ crm_contactsâ”‚
â”‚  â”‚ â€¢ crm_entities  â”‚    â”‚ â€¢ crm_entities  â”‚    â”‚ â€¢ crm_entitiesâ”‚
â”‚  â”‚ â€¢ eventos       â”‚    â”‚ â€¢ eventos       â”‚    â”‚ â€¢ eventos   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    SHARED INFRASTRUCTURE                    â”‚ â”‚
â”‚  â”‚  â€¢ MongoDB Atlas Cluster                                   â”‚ â”‚
â”‚  â”‚  â€¢ Firebase Authentication                                 â”‚ â”‚
â”‚  â”‚  â€¢ GraphQL API Server                                      â”‚ â”‚
â”‚  â”‚  â€¢ Nginx Reverse Proxy                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

                        <h7>ğŸ” Sistema de Ownership y ComparticiÃ³n</h7>
                        <pre><code class="language-text">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                SISTEMA DE OWNERSHIP Y COMPARTICIÃ“N               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    RECURSO CRM                              â”‚ â”‚
â”‚  â”‚  (Lead, Contact, Entity, Event)                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                  â”‚
â”‚                              â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    OWNERSHIP                                â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ PRIMARY OWNER   â”‚  â”‚ SHARED USERS    â”‚  â”‚ SHARED      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚ GROUPS      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ user_id       â”‚  â”‚ â€¢ [user_id_1]   â”‚  â”‚ â€¢ [group_1] â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ name          â”‚  â”‚ â€¢ [user_id_2]   â”‚  â”‚ â€¢ [group_2] â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ permissions   â”‚  â”‚ â€¢ [user_id_3]   â”‚  â”‚ â€¢ [group_3] â”‚ â”‚ â”‚
â”‚  â”‚  â”‚   FULL_ACCESS   â”‚  â”‚ â€¢ permissions   â”‚  â”‚ â€¢ permissionsâ”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                  â”‚
â”‚                              â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    PERMISOS POR ROL                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚   OWNER         â”‚  â”‚   SHARED USER   â”‚  â”‚   GROUP     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚   MEMBER    â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Ver todo      â”‚  â”‚ â€¢ Ver limitado  â”‚  â”‚ â€¢ Ver segÃºn â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Editar todo   â”‚  â”‚ â€¢ Editar segÃºn  â”‚  â”‚   permisos  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Eliminar      â”‚  â”‚   permisos      â”‚  â”‚ â€¢ Editar    â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Compartir     â”‚  â”‚ â€¢ No eliminar   â”‚  â”‚   segÃºn     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Gestionar     â”‚  â”‚ â€¢ No compartir  â”‚  â”‚   permisos  â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

                        <h6>ğŸ”„ Flujo de ComparticiÃ³n y Validaciones</h6>
                        <pre><code class="language-graphql"># Validaciones de Seguridad Implementadas
export function validateDevelopmentAccess(
  context: CRMContext,
  development: string
) {
  if (context.user.development !== development) {
    throw new Error('No tienes acceso a este development');
  }
}

# ValidaciÃ³n de ownership y permisos compartidos
export function validateOwnership(
  document: any,
  userId: string,
  allowShared: boolean = true
) {
  const isOwner = document.ownership?.primary_owner?.user_id === userId;
  const isShared = allowShared && 
    document.ownership?.shared_with_users?.includes(userId);

  if (!isOwner && !isShared) {
    throw new Error('No tienes permisos para acceder a este recurso');
  }

  return { isOwner, isShared };
}

# Flujo completo de comparticiÃ³n
type CRM_SharingFlow {
  # Paso 1: Verificar propiedad del recurso
  checkOwnership: Boolean! {
    document.ownership.primary_owner.user_id === currentUser.uid
  }
  
  # Paso 2: Validar acceso al development
  validateDevelopment: Boolean! {
    context.user.development === document.development
  }
  
  # Paso 3: Aplicar permisos de comparticiÃ³n
  applySharing: Boolean! {
    updateSharedUsers() && updateSharedGroups()
  }
  
  # Paso 4: Validar lÃ­mites de comparticiÃ³n
  validateLimits: Boolean! {
    maxSharedUsers <= 50 && maxSharedGroups <= 20
  }
  
  # Paso 5: Registrar auditorÃ­a
  logAudit: Boolean! {
    recordSharingAction(userId, resourceId, permissions)
  }
}</code></pre>
                        <pre><code class="language-graphql"># Flujo de ComparticiÃ³n de Evento
type EventSharingFlow {
  # Paso 1: Verificar Propiedad
  checkOwnership: Boolean! {
    event.usuario_id === currentUser.uid
  }
  
  # Paso 2: Validar Usuario Destino
  validateTargetUser: Boolean! {
    userExists && userActive && userInSameDevelopment
  }
  
  # Paso 3: Aplicar Permisos
  applyPermissions: SharePermissionsInput! {
    canViewBudget: Boolean!
    canViewGuests: Boolean!
    canEditEvent: Boolean!
    canInviteGuests: Boolean!
  }
  
  # Paso 4: Actualizar Base de Datos
  updateDatabase: Boolean! {
    event.compartido_array.push(userId)
    event.detalles_compartidos_array.push(shareDetail)
  }
  
  # Paso 5: Notificar Usuario
  notifyUser: Boolean! {
    sendEmailNotification || sendPushNotification
  }
}

# Validaciones de Seguridad
type SecurityValidations {
  # Verificar que solo el propietario puede compartir
  ownerOnlySharing: Boolean!
  
  # Verificar que el usuario no se comparte a sÃ­ mismo
  noSelfSharing: Boolean!
  
  # Verificar lÃ­mites de comparticiÃ³n
  sharingLimits: Boolean! {
    maxSharedUsers <= 50
    maxPermissionsPerUser <= 10
  }
  
  # Verificar permisos heredados
  inheritedPermissions: Boolean! {
    sharedUser.cannotHaveMorePermissionsThanOwner
  }
}</code></pre>

                        <h5>ğŸ¯ Casos de Uso y Escenarios Reales</h5>
                        <pre><code class="language-graphql"># Escenario 1: Organizador de Boda Comparte con Proveedores
type WeddingSharingScenario {
  # Organizador (CREADOR) comparte con:
  photographer: ShareDetail! {
    permissions: {
      canViewEvent: true
      canViewGuests: true
      canViewItinerary: true
      canViewBudget: false      # No ver presupuesto
      canEditEvent: false       # No editar evento
      canInviteGuests: false    # No invitar gente
    }
  }
  
  caterer: ShareDetail! {
    permissions: {
      canViewEvent: true
      canViewGuests: true       # Para saber cuÃ¡ntos comensales
      canViewItinerary: true    # Para horarios de comida
      canViewBudget: false      # No ver presupuesto
      canEditEvent: false
    }
  }
  
  weddingPlanner: ShareDetail! {
    permissions: {
      canViewEvent: true
      canViewGuests: true
      canViewItinerary: true
      canViewBudget: true       # Ver presupuesto para planificar
      canEditEvent: true        # Editar detalles del evento
      canInviteGuests: true     # Invitar gente
      canShareEvent: false      # No compartir con otros
    }
  }
}

# Escenario 2: Empresa Comparte Evento Corporativo
type CorporateEventSharingScenario {
  # CEO (CREADOR) comparte con:
  marketingTeam: ShareDetail! {
    permissions: {
      canViewEvent: true
      canViewGuests: true
      canViewItinerary: true
      canViewBudget: true
      canEditEvent: true
      canInviteGuests: true
      canShareEvent: false
    }
  }
  
  financeTeam: ShareDetail! {
    permissions: {
      canViewEvent: true
      canViewGuests: false      # No ver invitados
      canViewItinerary: false   # No ver itinerario
      canViewBudget: true       # Solo ver presupuesto
      canEditEvent: false
      canInviteGuests: false
    }
  }
  
  attendees: ShareDetail! {
    permissions: {
      canViewEvent: true
      canViewGuests: false      # No ver otros invitados
      canViewItinerary: true    # Ver agenda del evento
      canViewBudget: false      # No ver presupuesto
      canEditEvent: false
      canInviteGuests: false
    }
  }
}</code></pre>

                        <h5>ğŸ“‹ Resumen del Sistema de Permisos y Mejores PrÃ¡cticas</h5>
                        <pre><code class="language-graphql"># Resumen de Funcionalidades Implementadas
type PermissionsSystemSummary {
  # Sistema de Roles
  roles: [String!]! {
    "CREADOR"      # Acceso completo - Propietario
    "COMPARTIDO"   # Acceso bÃ¡sico - Usuario compartido  
    "INVITADO"     # Acceso limitado - Usuario invitado
    "SIN_ACCESO"   # Sin acceso - Sin permisos
  }
  
  # Permisos Granulares
  permissions: [String!]! {
    "VisualizaciÃ³n"    # Ver presupuesto, invitados, itinerarios
    "EdiciÃ³n"          # Editar evento, invitar gente
    "AdministraciÃ³n"   # Compartir, eliminar, gestionar
  }
  
  # Recursos Compartibles
  shareableResources: [String!]! {
    "Eventos"          # EVT_Event con sistema completo
    "Leads"            # CRM_Lead con ownership
    "Contactos"        # CRM_Contact con permisos
    "Entidades"        # CRM_Entity con acceso
  }
  
  # Servicios Implementados
  services: [String!]! {
    "EventPermissionService"           # Servicio principal
    "EnhancedEventPermissionService"   # Servicio mejorado
    "EventPermissionModel"            # Modelo de BD
  }
}

# Mejores PrÃ¡cticas de Seguridad
type SecurityBestPractices {
  # Principio de MÃ­nimo Privilegio
  leastPrivilege: String! {
    "Solo dar permisos necesarios para la tarea"
  }
  
  # VerificaciÃ³n de Propiedad
  ownershipVerification: String! {
    "Solo el propietario puede compartir recursos"
  }
  
  # AuditorÃ­a de Accesos
  accessAudit: String! {
    "Registrar todas las acciones de comparticiÃ³n"
  }
  
  # LÃ­mites de ComparticiÃ³n
  sharingLimits: String! {
    "MÃ¡ximo 50 usuarios compartidos por recurso"
  }
  
  # Permisos Heredados
  inheritedPermissions: String! {
    "Usuario compartido no puede tener mÃ¡s permisos que el propietario"
  }
}</code></pre>
                    </div>

                    <h4>ğŸ¢ Sistema CRM de ComparticiÃ³n y Ownership</h4>
                    <div class="crm-system-section">
                        <h5>ğŸ” Arquitectura Multi-Tenant y Sistema de Permisos</h5>
                        
                        <h6>ğŸ—ï¸ Estructura del Sistema Multi-Developer</h6>
                        <pre><code class="language-graphql"># Sistema de Marca Blanca (Whitelabel) Implementado
type Whitelabel {
  id: ID!
  name: String!                    # Nombre de la marca
  whiteLabelDomain: String!        # Dominio personalizado
  development: String!             # ID Ãºnico del developer
  slug: String!                    # Slug de la marca
  
  # ConfiguraciÃ³n del Developer
  developer: WhitelabelDeveloper! {
    id: String!                    # ID del desarrollador
    name: String!                  # Nombre del desarrollador
    email: String!                 # Email del desarrollador
    permissions: [String!]!        # Permisos del developer
    isEnabled: Boolean!            # Si estÃ¡ habilitado
    apiKey: String                 # API key para integraciones
    webhookUrl: String             # URL para webhooks
    rateLimit: Int                 # LÃ­mite de rate limiting
  }
  
  # Features Habilitados por Tenant
  features: WhitelabelFeatures! {
    events: Boolean!               # MÃ³dulo de eventos
    users: Boolean!                # GestiÃ³n de usuarios
    business: Boolean!             # GestiÃ³n de negocios
    posts: Boolean!                # Sistema de posts
    categories: Boolean!           # CategorÃ­as
    filters: Boolean!              # Filtros
    groups: Boolean!               # Sistema de grupos
    viewConfig: Boolean!           # ConfiguraciÃ³n de vistas
    analytics: Boolean!            # Analytics
    notifications: Boolean!        # Notificaciones
    payments: Boolean!             # Pagos
    integrations: Boolean!         # Integraciones
    customBranding: Boolean!       # Branding personalizado
    multiLanguage: Boolean!        # Multi-idioma
  }
  
  # LÃ­mites por Tenant
  limits: WhitelabelLimits! {
    users: Int                     # MÃ¡ximo de usuarios
    events: Int                    # MÃ¡ximo de eventos
    storage: Int                   # Almacenamiento mÃ¡ximo (bytes)
    apiCalls: Int                  # Llamadas API mÃ¡ximas por dÃ­a
    customizations: Int            # Personalizaciones mÃ¡ximas
  }
  
  # ConfiguraciÃ³n de Seguridad
  settings: WhitelabelSettings! {
    theme: JSON                    # Tema personalizado
    branding: JSON                 # Branding especÃ­fico
    notifications: JSON            # ConfiguraciÃ³n de notificaciones
    security: JSON                 # ConfiguraciÃ³n de seguridad
    performance: JSON              # ConfiguraciÃ³n de performance
  }
}</code></pre>

                        <h6>ğŸ” Sistema de Ownership y ComparticiÃ³n</h6>
                        <pre><code class="language-graphql"># Estructura de Ownership implementada en TODOS los mÃ³dulos CRM
type CRM_Ownership {
  # Propietario principal del recurso
  primary_owner: CRM_OwnerInfo! {
    user_id: String!               # Firebase UID del propietario
    name: String!                  # Nombre/Email del propietario
  }
  
  # Usuarios con acceso compartido (individual)
  shared_with_users: [String!]!    # Array de Firebase UIDs
  
  # Grupos con acceso compartido
  shared_with_groups: [ID!]!       # Array de ObjectIds de grupos
}

# InformaciÃ³n del propietario
type CRM_OwnerInfo {
  user_id: String!                 # Firebase UID
  name: String!                    # Nombre o email
}

# Sistema de comparticiÃ³n implementado en:
# - CRM_Lead (crm_leads collection)
# - CRM_Contact (crm_contacts collection)  
# - CRM_Entity (crm_entities collection)
# - EVT_Event (eventos collection)

# Campos de comparticiÃ³n en cada registro
type CRM_SharingFields {
  development: String!              # ID del developer/tenant
  ownership: CRM_Ownership!        # Sistema de ownership
  
  # InformaciÃ³n de marca blanca
  whitelabel_info: CRM_WhitelabelInfo! {
    whitelabel_id: String!         # ID de la marca blanca
    name: String!                  # Nombre de la marca
    domain: String!                # Dominio de la marca
    developer_uid: String!         # UID del developer
  }
}</code></pre>

                        <h6>ğŸ¤ Sistema de ComparticiÃ³n Multi-Nivel</h6>
                        <pre><code class="language-graphql"># Compartir Lead con usuarios y grupos
mutation ShareCRMLead($leadId: ID!, $sharing: LeadSharingInput!) {
  shareCRMLead(leadId: $leadId, sharing: $sharing) {
    success
    lead {
      ownership {
        shared_with_users    # Usuarios individuales
        shared_with_groups   # Grupos de usuarios
      }
    }
    errors
  }
}

# Compartir Contacto
mutation ShareCRMContact($contactId: ID!, $sharing: ContactSharingInput!) {
  shareCRMContact(contactId: $contactId, sharing: $sharing) {
    success
    contact {
      ownership {
        shared_with_users
        shared_with_groups
      }
    }
    errors
  }
}

# Compartir Entidad
mutation ShareCRMEntity($entityId: ID!, $sharing: EntitySharingInput!) {
  shareCRMEntity(entityId: $entityId, sharing: $sharing) {
    success
    entity {
      ownership {
        shared_with_users
        shared_with_groups
      }
    }
    errors
  }
}

# Estructuras de comparticiÃ³n
input LeadSharingInput {
  userIds: [String!]!    # IDs de usuarios para compartir
  groupIds: [ID!]!       # IDs de grupos para compartir
  permissions: [String!]! # Permisos especÃ­ficos
}

input ContactSharingInput {
  userIds: [String!]!
  groupIds: [ID!]!
  permissions: [String!]!
}

input EntitySharingInput {
  userIds: [String!]!
  groupIds: [ID!]!
  permissions: [String!]!
}</code></pre>
                    </div>

                    <h4>ğŸš€ MÃ³dulo de CampaÃ±as (BUSN)</h4>
                    <div class="campaigns-section">
                        <h5>GestiÃ³n Integral de CampaÃ±as</h5>
                        <pre><code class="language-graphql">type CRM_Campaign {
  _id: ID!
  name: String!
  description: String
  type: CampaignType!
  status: CampaignStatus!
  
  # Objetivos y KPIs
  objectives: [CampaignObjective!]!
  kpis: [CampaignKPI!]!
  targetMetrics: CampaignMetrics!
  
  # Audiencia y SegmentaciÃ³n
  targetAudience: TargetAudience!
  segments: [AudienceSegment!]
  filters: AudienceFilters
  
  # Canales y Contenido
  channels: [CampaignChannel!]!
  content: [CampaignContent!]
  creative: CreativeAssets
  
  # ProgramaciÃ³n y AutomatizaciÃ³n
  schedule: CampaignSchedule!
  automation: AutomationRules
  triggers: [Trigger!]
  
  # Presupuesto y ROI
  budget: CampaignBudget!
  roi: ROIMetrics!
  performance: PerformanceMetrics!
  
  # Metadatos
  tags: [String!]
  customFields: JSON
  createdAt: DateTime!
  updatedAt: DateTime!
}</code></pre>
                    </div>

                    <h4>ğŸ”§ Enums y Tipos Especializados</h4>
                    <div class="enum-section">
                        <div class="enum-card">
                            <h6><i class="fas fa-list"></i> LeadStatus</h6>
                            <pre><code class="language-graphql">enum LeadStatus {
  NUEVO
  CONTACTADO
  CALIFICADO
  PROPUESTA
  NEGOCIACION
  GANADO
  PERDIDO
  RECHAZADO
}</code></pre>
                        </div>

                        <div class="enum-card">
                            <h6><i class="fas fa-list"></i> LeadSource</h6>
                            <pre><code class="language-graphql">enum LeadSource {
  WEB
  PHONE
  REFERRAL
  SOCIAL
  EVENT
  EMAIL
  COLD_CALL
  PARTNER
  ADVERTISING
  OTHER
}</code></pre>
                        </div>

                        <div class="enum-card">
                            <h6><i class="fas fa-list"></i> Priority</h6>
                            <pre><code class="language-graphql">enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}</code></pre>
                        </div>

                        <div class="enum-card">
                            <h6><i class="fas fa-list"></i> EventType</h6>
                            <pre><code class="language-graphql">enum EventType {
  CONFERENCE
  SEMINAR
  WORKSHOP
  NETWORKING
  PRODUCT_LAUNCH
  TRAINING
  MEETING
  PRESENTATION
  DEMO
  WEBINAR
  HACKATHON
  COMPETITION
  EXHIBITION
  TRADE_SHOW
  AWARDS
  GALA
  PARTY
  CELEBRATION
  TEAM_BUILDING
  CORPORATE_EVENT
}</code></pre>
                        </div>
                    </div>

                    <h4>ğŸ” Queries y Mutations Principales</h4>
                    <div class="query-section">
                        <div class="query-card">
                            <h6><i class="fas fa-search"></i> Obtener Leads con Filtros</h6>
                            <pre><code class="language-graphql">query GetLeads(
  $filters: LeadFilterInput
  $pagination: PaginationInput
  $sort: LeadSortInput
) {
  getCRMLeads(
    filters: $filters
    pagination: $pagination
    sort: $sort
  ) {
    leads {
      _id
      name
      email
      company
      status
      source
      value
      probability
      assignedTo
      tags
      nextFollowUp
      lastContact
      createdAt
      updatedAt
    }
    totalCount
    pageInfo {
      hasNextPage
      hasPreviousPage
    }
  }
}</code></pre>
                        </div>

                        <div class="query-card">
                            <h6><i class="fas fa-search"></i> Obtener Contactos</h6>
                            <pre><code class="language-graphql">query GetContacts(
  $filters: ContactFilterInput
  $pagination: PaginationInput
) {
  getCRMContacts(
    filters: $filters
    pagination: $pagination
  ) {
    contacts {
      _id
      firstName
      lastName
      email
      phone
      company
      jobTitle
      status
      assignedTo
      tags
      lastContact
      nextFollowUp
      createdAt
      updatedAt
    }
    totalCount
    pageInfo {
      hasNextPage
      hasPreviousPage
    }
  }
}</code></pre>
                        </div>
                    </div>

                    <div class="mutation-section">
                        <div class="mutation-card">
                            <h6><i class="fas fa-plus"></i> Crear Lead</h6>
                            <pre><code class="language-graphql">mutation CreateLead($input: LeadInput!) {
  createCRMLead(input: $input) {
    _id
    name
    email
    company
    status
    source
    value
    probability
    assignedTo
    tags
    description
    nextFollowUp
    createdAt
    updatedAt
    validation {
      isValid
      errors {
        field
        message
        code
      }
    }
  }
}</code></pre>
                        </div>

                        <div class="mutation-card">
                            <h6><i class="fas fa-edit"></i> Actualizar Lead</h6>
                            <pre><code class="language-graphql">mutation UpdateLead($id: ID!, $input: LeadUpdateInput!) {
  updateCRMLead(id: $id, input: $input) {
    _id
    name
    email
    company
    status
    source
    value
    probability
    assignedTo
    tags
    description
    nextFollowUp
    lastContact
    updatedAt
    changeHistory {
      field
      oldValue
      newValue
      changedBy
      changedAt
    }
  }
}</code></pre>
                        </div>
                    </div>

                    <h4>ğŸ“Š MÃ©tricas y Analytics</h4>
                    <div class="metrics-section">
                        <div class="metrics-card">
                            <h6><i class="fas fa-chart-line"></i> Dashboard de Leads</h6>
                            <pre><code class="language-graphql">query GetLeadAnalytics($dateRange: DateRangeInput) {
  getLeadAnalytics(dateRange: $dateRange) {
    overview {
      totalLeads
      newLeads
      convertedLeads
      conversionRate
      totalValue
      averageValue
      averageTimeToConvert
    }
    
    byStatus {
      status
      count
      value
      percentage
    }
    
    bySource {
      source
      count
      conversionRate
      averageValue
    }
    
    trends {
      date
      newLeads
      convertedLeads
      conversionRate
    }
    
    performance {
      assignedTo
      leadsAssigned
      leadsConverted
      conversionRate
      totalValue
    }
  }
}</code></pre>
                        </div>
                    </div>

                    <h4>âš ï¸ Manejo de Errores y CÃ³digos de Estado</h4>
                    <div class="error-section">
                        <div class="error-card">
                            <h6><i class="fas fa-exclamation-triangle"></i> CÃ³digos de Error Comunes</h6>
                            <pre><code class="language-json">{
  "errors": [
    {
      "message": "Validation failed",
      "extensions": {
        "code": "VALIDATION_ERROR",
        "field": "email",
        "details": "Invalid email format"
      }
    }
  ]
}</code></pre>
                        </div>

                        <div class="error-card">
                            <h6><i class="fas fa-shield-alt"></i> CÃ³digos de Estado HTTP</h6>
                            <ul>
                                <li><strong>200 OK:</strong> OperaciÃ³n exitosa</li>
                                <li><strong>201 Created:</strong> Recurso creado exitosamente</li>
                                <li><strong>400 Bad Request:</strong> Error de validaciÃ³n o datos incorrectos</li>
                                <li><strong>401 Unauthorized:</strong> Token de autenticaciÃ³n invÃ¡lido o expirado</li>
                                <li><strong>403 Forbidden:</strong> Sin permisos para acceder al recurso</li>
                                <li><strong>404 Not Found:</strong> Recurso no encontrado</li>
                                <li><strong>429 Too Many Requests:</strong> LÃ­mite de rate limiting excedido</li>
                                <li><strong>500 Internal Server Error:</strong> Error interno del servidor</li>
                            </ul>
                        </div>
                    </div>

                    <h4>ğŸ” Seguridad y Permisos</h4>
                    <div class="security-section">
                        <div class="security-card">
                            <h6><i class="fas fa-lock"></i> AutenticaciÃ³n JWT</h6>
                            <p>La API utiliza tokens JWT para autenticaciÃ³n. Cada request debe incluir:</p>
                            <ul>
                                <li><strong>Authorization:</strong> Bearer token vÃ¡lido</li>
                                <li><strong>X-User-ID:</strong> ID del usuario autenticado</li>
                                <li><strong>X-Development:</strong> ID del desarrollo/empresa</li>
                            </ul>
                        </div>

                        <div class="security-card">
                            <h6><i class="fas fa-user-shield"></i> Control de Acceso</h6>
                            <p>El sistema implementa control de acceso basado en roles (RBAC):</p>
                            <ul>
                                <li><strong>Admin:</strong> Acceso completo a todos los recursos</li>
                                <li><strong>Manager:</strong> Acceso a leads y contactos de su equipo</li>
                                <li><strong>Sales:</strong> Acceso solo a sus leads asignados</li>
                                <li><strong>Viewer:</strong> Acceso de solo lectura</li>
                            </ul>
                        </div>

                        <div class="security-card">
                            <h6><i class="fas fa-shield-alt"></i> Rate Limiting</h6>
                            <p>ProtecciÃ³n contra abuso de la API:</p>
                            <ul>
                                <li><strong>LÃ­mite por usuario:</strong> 1000 requests por hora</li>
                                <li><strong>LÃ­mite por IP:</strong> 5000 requests por hora</li>
                                <li><strong>LÃ­mite por endpoint:</strong> 100 requests por minuto</li>
                                <li><strong>Headers de respuesta:</strong> X-RateLimit-*</li>
                            </ul>
                        </div>
                    </div>

                    <h4>ğŸ§ª Testing y Sandbox</h4>
                    <div class="testing-section">
                        <div class="testing-card">
                            <h6><i class="fas fa-flask"></i> Entorno de Testing</h6>
                            <p>Utiliza el endpoint de test para desarrollo y pruebas:</p>
                            <pre><code class="language-bash"># Endpoint de testing
https://testapi2.eventosorganizador.com/graphql

# Base de datos separada para testing
# No afecta datos de producciÃ³n
# Ideal para desarrollo e integraciÃ³n</code></pre>
                        </div>

                        <div class="testing-card">
                            <h6><i class="fas fa-tools"></i> Herramientas Recomendadas</h6>
                            <ul>
                                <li><strong>GraphQL Playground:</strong> IDE integrado en la API</li>
                                <li><strong>Insomnia:</strong> Cliente REST/GraphQL avanzado</li>
                                <li><strong>Postman:</strong> Testing de APIs completo</li>
                                <li><strong>cURL:</strong> LÃ­nea de comandos</li>
                            </ul>
                        </div>
                    </div>

                    <h4>ğŸ¯ PrÃ³ximos Pasos</h4>
                    <div class="next-steps-section">
                        <div class="next-steps-card">
                            <h6><i class="fas fa-rocket"></i> ImplementaciÃ³n</h6>
                            <ol>
                                <li>Configurar autenticaciÃ³n JWT</li>
                                <li>Implementar cliente GraphQL</li>
                                <li>Crear componentes de UI</li>
                                <li>Configurar manejo de errores</li>
                                <li>Implementar cache y optimizaciones</li>
                            </ol>
                        </div>

                        <div class="next-steps-card">
                            <h6><i class="fas fa-book"></i> Recursos Adicionales</h6>
                            <ul>
                                <li><strong>DocumentaciÃ³n GraphQL:</strong> <a href="https://graphql.org/learn/" target="_blank">graphql.org</a></li>
                                <li><strong>Apollo Client:</strong> <a href="https://www.apollographql.com/docs/react/" target="_blank">apollographql.com</a></li>
                                <li><strong>React TypeScript:</strong> <a href="https://react-typescript-cheatsheet.netlify.app/" target="_blank">Cheat Sheet</a></li>
                                <li><strong>MongoDB Atlas:</strong> <a href="https://docs.atlas.mongodb.com/" target="_blank">docs.atlas.mongodb.com</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Frontend Setup Section -->
        <section id="frontend" class="section">
            <div class="container">
                <div class="section-header">
                    <h3><i class="fas fa-laptop-code"></i> Frontend Setup</h3>
                    <p>ConfiguraciÃ³n de React + TypeScript + Apollo Client</p>
                </div>
                
                <div class="content-card">
                    <h4>âš™ï¸ ConfiguraciÃ³n Inicial</h4>
                    <div class="setup-steps">
                        <div class="step">
                            <span class="step-number">1</span>
                            <div class="step-content">
                                <h5>InstalaciÃ³n de Dependencias</h5>
                                <pre><code class="language-bash">npm install @apollo/client graphql react react-dom typescript
npm install --save-dev @types/react @types/react-dom</code></pre>
                            </div>
                        </div>
                        
                        <div class="step">
                            <span class="step-number">2</span>
                            <div class="step-content">
                                <h5>ConfiguraciÃ³n de Apollo Client</h5>
                                <pre><code class="language-typescript">import { ApolloClient, InMemoryCache, createHttpLink } from '@apollo/client';
import { setContext } from '@apollo/client/link/context';

const httpLink = createHttpLink({
  uri: 'https://api2.eventosorganizador.com/graphql',
});

const authLink = setContext((_, { headers }) => {
  const token = localStorage.getItem('jwt_token');
  const userId = localStorage.getItem('user_uid');
  const developmentId = localStorage.getItem('development_id');
  
  return {
    headers: {
      ...headers,
      authorization: token ? `Bearer ${token}` : "",
      'X-User-ID': userId || "",
      'X-Development': developmentId || "",
    }
  }
});

export const client = new ApolloClient({
  link: authLink.concat(httpLink),
  cache: new InMemoryCache(),
});</code></pre>
                            </div>
                        </div>
                    </div>

                    <h4>ğŸ£ Hooks Personalizados</h4>
                    <div class="hooks-example">
                        <p><strong>Hook para Leads:</strong></p>
                        <pre><code class="language-typescript">export const useLeads = (filter?: any, pagination?: any) => {
  const { data, loading, error, refetch } = useQuery(GET_LEADS, {
    variables: { filter, pagination },
    fetchPolicy: 'cache-and-network'
  });

  const [createLead] = useMutation(CREATE_LEAD, {
    onCompleted: () => {
      refetch();
    }
  });

  return {
    leads: data?.getCRMLeads?.leads || [],
    totalCount: data?.getCRMLeads?.totalCount || 0,
    pageInfo: data?.getCRMLeads?.pageInfo,
    loading,
    error,
    createLead,
    refetch
  };
};</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- Examples Section -->
        <section id="examples" class="section">
            <div class="container">
                <div class="section-header">
                    <h3><i class="fas fa-lightbulb"></i> Ejemplos</h3>
                    <p>Casos de uso prÃ¡cticos e implementaciones</p>
                </div>
                
                <div class="content-card">
                    <h4>ğŸ¯ Ejemplos de ImplementaciÃ³n</h4>
                    <div class="examples-grid">
                        <div class="example-card">
                            <h5><i class="fas fa-user-plus"></i> Crear un Nuevo Lead</h5>
                            <p>Formulario completo para captura de prospectos con validaciones y manejo de errores.</p>
                            <a href="#" class="btn btn-outline">Ver CÃ³digo</a>
                        </div>
                        <div class="example-card">
                            <h5><i class="fas fa-list"></i> Lista de Leads con Filtros</h5>
                            <p>Componente de listado con filtros avanzados, paginaciÃ³n y bÃºsqueda en tiempo real.</p>
                            <a href="#" class="btn btn-outline">Ver CÃ³digo</a>
                        </div>
                        <div class="example-card">
                            <h5><i class="fas fa-chart-bar"></i> Dashboard de Resumen</h5>
                            <p>Panel de control con estadÃ­sticas, grÃ¡ficos y actividad reciente del CRM.</p>
                            <a href="#" class="btn btn-outline">Ver CÃ³digo</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Deployment Section -->
        <section id="deployment" class="section">
            <div class="container">
                <div class="section-header">
                    <h3><i class="fas fa-rocket"></i> Deployment</h3>
                    <p>ConfiguraciÃ³n de producciÃ³n y despliegue</p>
                </div>
                
                <div class="content-card">
                    <h4>ğŸŒ ConfiguraciÃ³n del Entorno</h4>
                    <div class="env-example">
                        <p><strong>Variables de Entorno:</strong></p>
                        <pre><code class="language-bash"># ConfiguraciÃ³n de la base de datos
MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/crm_production

# ConfiguraciÃ³n de Firebase
FIREBASE_PROJECT_ID=your-project-id
FIREBASE_PRIVATE_KEY=your-private-key
FIREBASE_CLIENT_EMAIL=your-client-email

# ConfiguraciÃ³n del servidor
PORT=4000
NODE_ENV=production
JWT_SECRET=your-super-secret-jwt-key</code></pre>
                    </div>

                    <h4>ğŸ³ ConfiguraciÃ³n de Docker</h4>
                    <div class="docker-example">
                        <p><strong>Dockerfile:</strong></p>
                        <pre><code class="language-dockerfile">FROM node:18-alpine

WORKDIR /app

# Copiar package.json y package-lock.json
COPY package*.json ./

# Instalar dependencias
RUN npm ci --only=production

# Copiar cÃ³digo fuente
COPY . .

# Compilar TypeScript
RUN npm run build

# Exponer puerto
EXPOSE 4000

# Comando de inicio
CMD ["npm", "start"]</code></pre>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>CRM Marketing Soluciones</h4>
                    <p>Sistema completo de gestiÃ³n de relaciones con clientes</p>
                </div>
                <div class="footer-section">
                    <h4>Enlaces RÃ¡pidos</h4>
                    <ul>
                        <li><a href="#api">API GraphQL</a></li>
                        <li><a href="#frontend">Frontend</a></li>
                        <li><a href="#examples">Ejemplos</a></li>
                        <li><a href="#deployment">Deployment</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Contacto</h4>
                    <p>Equipo de Desarrollo</p>
                    <p>Marketing Soluciones</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 CRM Marketing Soluciones. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="assets/js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</body>
</html>
